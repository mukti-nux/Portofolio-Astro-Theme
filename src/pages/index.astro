---
import Stats from '../components/Stats.astro';
import Features from '../components/Features.astro';
import HeroSection from '../components/HeroSection.astro';
import Layout from '../layouts/Layout.astro';
import Testimonials from '../components/Testimonials.astro';
import CallToAction from '../components/CallToAction.astro';
import Blog from '../components/Blog.astro';
---

<Layout title="Welcome to Astrolus.">
  <!-- ðŸŸ  WELCOME OVERLAY -->
  <div id="overlay" 
    class="fixed inset-0 bg-black/80 flex flex-col items-center justify-center text-white z-50 cursor-pointer">

    <!-- ðŸ”µ Logo SVG -->
    <div class="w-80 h-auto mb-4 animasi-muncul">
      <img src="https://raw.githubusercontent.com/mukti-nux/Framer-asset/8fe14136d42b29b83cd3cd53484460e5b859ca04/svgviewer-output%20(1).svg" alt="logo" class="w-full h-full"/>
    </div>

    <!-- ðŸŸ¢ Teks Welcome -->
    <h1 class="text-2xl font-bold mb-2 animasi-muncul">Welcome To Portofolio Mukti Ver.2</h1>
    <p class="text-sm opacity-75 animasi-muncul">Click anywhere to start. Using desktop for better experience</p>
  </div>

  <!-- ðŸŸ£ Popup Sambutan ShazQIAI -->
  <div
    id="shazqi-popup"
    class="fixed bottom-6 right-6 max-w-xs p-4 bg-white dark:bg-gray-800 text-gray-900 dark:text-white rounded-xl shadow-lg border dark:border-gray-700 transform transition-all duration-500 ease-in-out translate-x-full opacity-0 z-40 cursor-pointer"
    onclick="closePopup()"
  >
    <div class="text-base font-semibold mb-1">ðŸ‘‹ Halo!</div>
    <div class="text-sm">Aku <strong>ShazQIAI</strong>, siap bantu kamu hari ini âœ¨</div>
  </div>

  <body>
     <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/loaders/GLTFLoader.js"></script>
  </body>

  <!-- ðŸ”§ Script Client -->
  <script is:client>
    const overlay = document.getElementById('overlay');
    const popup = document.getElementById('shazqi-popup');

    function closePopup() {
      popup?.classList.add("translate-x-full", "opacity-0");
    }

    overlay?.addEventListener('click', () => {
      overlay.remove();

      // Tampilkan popup ShazQIAI setelah overlay ditutup
      setTimeout(() => {
        popup?.classList.remove("translate-x-full", "opacity-0");
      }, 300);

      // Auto-close popup setelah 6 detik
      setTimeout(() => {
        closePopup();
      }, 15000);
    });

    // Setup scene
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.z = 5;

      const renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      const mouse = { x: 0, y: 0 };

      // Lighting (optional)
      const light = new THREE.DirectionalLight(0xffffff, 1);
      light.position.set(1, 1, 1);
      scene.add(light);

      // Load GLB model
      let model;
      const loader = new THREE.GLTFLoader();
      loader.load('Koala.glb', (gltf) => {
        model = gltf.scene;
        model.scale.set(1, 1, 1); // atur sesuai kebutuhan
        scene.add(model);
      });

      // Mouse movement
      document.addEventListener('mousemove', (event) => {
        mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
        mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
      });

      // Animate
      function animate() {
        requestAnimationFrame(animate);
        if (model) {
          model.position.x += (mouse.x * 5 - model.position.x) * 0.05;
          model.position.y += (mouse.y * 5 - model.position.y) * 0.05;
        }
        renderer.render(scene, camera);
      }
      animate();

  </script>

  <!-- ðŸŽ¨ Style Animasi -->
  <style>
    @keyframes muncul {
      from { opacity: 0; transform: scale(0.8); }
      to { opacity: 1; transform: scale(1); }
    }
    .animasi-muncul {
      animation: muncul 1s ease-out forwards;
    }
  </style>

  <!-- ðŸŸ¢ Konten Halaman -->
  <main class="space-y-40 mb-40">
    <HeroSection/>
    <Features/>
    <Stats/>
    <Testimonials/>
    <CallToAction/>
    <Blog/>
  </main>
</Layout>
